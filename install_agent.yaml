---
 - hosts: PleaseChangeMe
   tasks:
    - name: Install the RPM for x86_64
      yum: name=http://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm
      when: ansible_architecture == "x86_64"

    - name: Copy the repo file for ppc64le zabbix agent.
      get_url:
        url: http://mochat.massopen.cloud/repos/ppc64le-zabbix-4.repo
        dest: /etc/yum.repos.d/ppc64le-zabbix-4.repo
        force: yes
      when: ansible_architecture == "ppc64le"

    - name: Install zabbix agent
      yum:
        name: zabbix-agent
        state: latest
        update_cache: yes

    - name: Copy zabbix agent configuration file from github
      get_url:
        url: https://raw.githubusercontent.com/CCI-MOC/zabbix-config/master/agent_config_files/zabbix_agentd.conf
        dest: /etc/zabbix/zabbix_agentd.conf
        force: yes

    - name: Start and enable zabbix agent
      service:
        name: zabbix-agent
        state: started
        enabled: yes

